# ğŸš€ ãƒ©ã‚ºãƒ‘ã‚¤ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## ğŸ“… äº‹å‰æº–å‚™ï¼ˆWindowsç’°å¢ƒã§ï¼‰

### âœ… 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†

**ãƒ•ã‚¡ã‚¤ãƒ«:** `backend/scripts/system_config.py`

```python
# ä»¥ä¸‹ã®é …ç›®ã‚’å®Ÿéš›ã®å€¤ã«å¤‰æ›´

# ãƒ‘ã‚¹è¨­å®šï¼ˆãƒ©ã‚ºãƒ‘ã‚¤ã§ã®å®Ÿéš›ã®ãƒ‘ã‚¹ã«å¤‰æ›´ï¼‰
APP_DIR = "/home/pi/ecm/backend"
BACKUP_DIR = "/mnt/usb_backup/ecm"

# ãƒ¡ãƒ¼ãƒ«è¨­å®š
SENDER_EMAIL = "ã‚ãªãŸã®Gmail@gmail.com"
SENDER_PASSWORD = "Googleã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰16æ¡"
RECIPIENT_EMAILS = [
    "é€šçŸ¥å…ˆ1@example.com",
    "é€šçŸ¥å…ˆ2@example.com"
]

# Cloudflare Tunnel URLï¼ˆç§»è¡Œå¾Œã«è¨­å®šï¼‰
TUNNEL_URL = "https://your-tunnel-url.trycloudflare.com"
```

**é‡è¦:** Googleã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å–å¾—æ–¹æ³•
1. Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³
2. https://myaccount.google.com/security ã«ã‚¢ã‚¯ã‚»ã‚¹
3. ã€Œ2æ®µéšèªè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã€ã‚’æœ‰åŠ¹åŒ–
4. ã€Œã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚’æ¤œç´¢
5. ã€Œãã®ä»–ï¼ˆã‚«ã‚¹ã‚¿ãƒ åï¼‰ã€ã§ã€ŒECMã€ã‚’å…¥åŠ›
6. ç”Ÿæˆã•ã‚ŒãŸ16æ¡ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼

---

### âœ… 2. GitHubãƒªãƒã‚¸ãƒˆãƒªä½œæˆï¼ˆæ¨å¥¨ï¼‰

```bash
# Windowsç’°å¢ƒã§
cd C:\Users\yagin\Desktop\ecm

# Gitãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–
git init
git add .
git commit -m "Initial commit"

# GitHubã«ãƒ—ãƒƒã‚·ãƒ¥
git remote add origin https://github.com/ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ecm.git
git push -u origin main
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ãƒ©ã‚ºãƒ‘ã‚¤ã¸ã®è»¢é€ãŒç°¡å˜
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- äºˆå‚™æ©Ÿã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚æ¥½

---

## ğŸ”§ ãƒ©ã‚ºãƒ‘ã‚¤å´ã®ä½œæ¥­

### âœ… 1. åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo apt update
sudo apt upgrade -y

# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
sudo apt install -y python3 python3-pip python3-venv git sqlite3
```

---

### âœ… 2. USBãƒ‰ãƒ©ã‚¤ãƒ–è¨­å®š

```bash
# USBã‚’æŒ¿ã—ã¦ãƒ‡ãƒã‚¤ã‚¹åç¢ºèª
lsblk

# å‡ºåŠ›ä¾‹:
# NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
# sda      8:0    1 59.5G  0 disk
# â””â”€sda1   8:1    1 59.5G  0 part

# ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆä½œæˆ
sudo mkdir -p /mnt/usb_backup

# ä¸€æ™‚ãƒã‚¦ãƒ³ãƒˆ
sudo mount /dev/sda1 /mnt/usb_backup

# è‡ªå‹•ãƒã‚¦ãƒ³ãƒˆè¨­å®š
sudo nano /etc/fstab

# ä»¥ä¸‹ã‚’æœ€çµ‚è¡Œã«è¿½åŠ :
/dev/sda1  /mnt/usb_backup  auto  defaults,nofail  0  2

# ä¿å­˜: Ctrl+O â†’ Enter â†’ Ctrl+X

# æ¨©é™è¨­å®š
sudo chown -R pi:pi /mnt/usb_backup

# ãƒ†ã‚¹ãƒˆ
sudo umount /mnt/usb_backup
sudo mount -a
ls /mnt/usb_backup
```

---

### âœ… 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é…ç½®

**æ–¹æ³•A: GitHubã‹ã‚‰ã‚¯ãƒ­ãƒ¼ãƒ³**
```bash
cd /home/pi
git clone https://github.com/ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ/ecm.git
```

**æ–¹æ³•B: SCPã§è»¢é€**
```bash
# Windowså´ï¼ˆPowerShellï¼‰ã§å®Ÿè¡Œ
scp -r C:\Users\yagin\Desktop\ecm pi@ãƒ©ã‚ºãƒ‘ã‚¤ã®IP:/home/pi/
```

---

### âœ… 4. Pythonç’°å¢ƒæ§‹ç¯‰

```bash
cd /home/pi/ecm/backend

# ä»®æƒ³ç’°å¢ƒä½œæˆ
python3 -m venv venv

# æœ‰åŠ¹åŒ–
source venv/bin/activate

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# Gunicornã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
pip install gunicorn
```

---

### âœ… 5. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
nano /home/pi/ecm/backend/scripts/system_config.py

# ä»¥ä¸‹ã‚’ç¢ºèª:
# - APP_DIR: /home/pi/ecm/backend
# - BACKUP_DIR: /mnt/usb_backup/ecm
# - ãƒ¡ãƒ¼ãƒ«è¨­å®šãŒæ­£ã—ã„ã‹
# - TUNNEL_URLã¯å¾Œã§è¨­å®šã™ã‚‹ã®ã§ä¸€æ—¦ã‚¹ã‚­ãƒƒãƒ—
```

---

### âœ… 6. å‹•ä½œãƒ†ã‚¹ãƒˆï¼ˆGunicornï¼‰

```bash
cd /home/pi/ecm/backend
source venv/bin/activate

# Gunicornèµ·å‹•ãƒ†ã‚¹ãƒˆ
gunicorn main:app -w 3 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000

# åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ç¢ºèª
curl http://localhost:8000

# æ­£å¸¸ãªã‚‰ Ctrl+C ã§åœæ­¢
```

---

### âœ… 7. systemdã‚µãƒ¼ãƒ“ã‚¹ç™»éŒ²

```bash
# ã‚µãƒ¼ãƒ“ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
sudo cp /home/pi/ecm/backend/systemd/*.service /etc/systemd/system/
sudo cp /home/pi/ecm/backend/systemd/*.timer /etc/systemd/system/

# systemdå†èª­ã¿è¾¼ã¿
sudo systemctl daemon-reload

# ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒ“ã‚¹æœ‰åŠ¹åŒ–ãƒ»èµ·å‹•
sudo systemctl enable ecm
sudo systemctl start ecm

# çŠ¶æ…‹ç¢ºèª
sudo systemctl status ecm

# ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹æœ‰åŠ¹åŒ–ï¼ˆTunnelè¨­å®šå¾Œã«èµ·å‹•ï¼‰
sudo systemctl enable ecm-monitor.timer
sudo systemctl enable ecm-disk-check.timer

# ä»Šã¯ã¾ã èµ·å‹•ã—ãªã„ï¼ˆTUNNEL_URLæœªè¨­å®šã®ãŸã‚ï¼‰
```

---

### âœ… 8. Cloudflare Tunnelè¨­å®š

```bash
# cloudflaredã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-arm64.deb
sudo dpkg -i cloudflared-linux-arm64.deb

# Cloudflareã«ãƒ­ã‚°ã‚¤ãƒ³
cloudflared tunnel login
# ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã®ã§ãƒ­ã‚°ã‚¤ãƒ³

# ãƒˆãƒ³ãƒãƒ«ä½œæˆ
cloudflared tunnel create ecm-tunnel

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
mkdir -p ~/.cloudflared
nano ~/.cloudflared/config.yml

# ä»¥ä¸‹ã‚’å…¥åŠ›:
tunnel: ecm-tunnel
credentials-file: /home/pi/.cloudflared/<TUNNEL-ID>.json

ingress:
  - hostname: your-domain.com
    service: http://localhost:8000
  - service: http_status:404

# ä¿å­˜: Ctrl+O â†’ Enter â†’ Ctrl+X

# DNSè¨­å®š
cloudflared tunnel route dns ecm-tunnel your-domain.com

# ãƒ†ã‚¹ãƒˆèµ·å‹•
cloudflared tunnel run ecm-tunnel

# åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¾ãŸã¯ã‚¹ãƒãƒ›ã§ https://your-domain.com ã«ã‚¢ã‚¯ã‚»ã‚¹
# å‹•ä½œç¢ºèªã§ããŸã‚‰ Ctrl+C ã§åœæ­¢
```

---

### âœ… 9. Tunnel URLè¨­å®š

```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
nano /home/pi/ecm/backend/scripts/system_config.py

# TUNNEL_URLã‚’å®Ÿéš›ã®URLã«å¤‰æ›´
TUNNEL_URL = "https://your-domain.com"

# ä¿å­˜: Ctrl+O â†’ Enter â†’ Ctrl+X
```

---

### âœ… 10. å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•

```bash
# Tunnelã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
sudo systemctl enable ecm-tunnel
sudo systemctl start ecm-tunnel
sudo systemctl status ecm-tunnel

# ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
sudo systemctl start ecm-monitor.timer
sudo systemctl start ecm-disk-check.timer

# çŠ¶æ…‹ç¢ºèª
sudo systemctl status ecm-monitor.timer
sudo systemctl status ecm-disk-check.timer
```

---

### âœ… 11. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šï¼ˆcronï¼‰

```bash
# crontabç·¨é›†
crontab -e

# ã‚¨ãƒ‡ã‚£ã‚¿é¸æŠï¼ˆnanoã‚’é¸ã¶ï¼‰

# æœ€çµ‚è¡Œã«ä»¥ä¸‹ã‚’è¿½åŠ :
0 3 * * * /usr/bin/python3 /home/pi/ecm/backend/scripts/backup.py >> /var/log/ecm_backup.log 2>&1

# ä¿å­˜: Ctrl+O â†’ Enter â†’ Ctrl+X

# è¨­å®šç¢ºèª
crontab -l
```

---

### âœ… 12. æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ

```bash
cd /home/pi/ecm/backend/scripts

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
python3 backup.py

# ç¢ºèª
ls -lh /mnt/usb_backup/ecm/
```

---

### âœ… 13. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãƒ†ã‚¹ãƒˆ

```bash
cd /home/pi/ecm/backend/scripts

# ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
python3 send_email.py

# é€šçŸ¥å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å±Šãã‹ç¢ºèª
```

---

### âœ… 14. ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ã‚¹ãƒˆ

```bash
cd /home/pi/ecm/backend/scripts

# Tunnelç›£è¦–ãƒ†ã‚¹ãƒˆ
python3 monitor_tunnel.py

# ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
python3 check_disk.py
```

---

## ğŸ‰ æœ€çµ‚ç¢ºèª

### âœ… å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ OK: `curl http://localhost:8000`
- [ ] å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ OK: ã‚¹ãƒãƒ›ã§ `https://your-domain.com`
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
- [ ] ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ»ç·¨é›†ã§ãã‚‹
- [ ] ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒå±Šã
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½œæˆã•ã‚Œã‚‹

### âœ… ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ç¢ºèª

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª
sudo systemctl status ecm
sudo systemctl status ecm-tunnel
sudo systemctl status ecm-monitor.timer
sudo systemctl status ecm-disk-check.timer

# ã‚¿ã‚¤ãƒãƒ¼ã®æ¬¡å›å®Ÿè¡Œæ™‚åˆ»ç¢ºèª
sudo systemctl list-timers
```

### âœ… ãƒ­ã‚°ç¢ºèª

```bash
# ã‚¢ãƒ—ãƒªãƒ­ã‚°
sudo journalctl -u ecm -n 50

# Tunnelãƒ­ã‚°
sudo journalctl -u ecm-tunnel -n 50

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ã‚°
cat /var/log/ecm_backup.log
```

---

## ğŸ”„ äºˆå‚™æ©Ÿã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

äºˆå‚™ãƒ©ã‚ºãƒ‘ã‚¤ã‚‚åŒã˜æ‰‹é †ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚

**é•ã„ã¯:**
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰DBã‚’å¾©æ—§ã™ã‚‹
- Cloudflare Tunnelã¯åŒã˜è¨­å®šã‚’ä½¿ã†

**æ‰‹é †:**
1. âœ… 1 ã€œ âœ… 7 ã¾ã§åŒã˜
2. `python3 restore.py` ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©æ—§
3. âœ… 8 ä»¥é™ã‚’å®Ÿæ–½

---

## ğŸ“ é‹ç”¨é–‹å§‹å¾Œã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### æ¯é€±

- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª: `ls -lh /mnt/usb_backup/ecm/`
- ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèª: `df -h`

### æ¯æœˆ

- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ: `sudo apt update && sudo apt upgrade`
- å¾©æ—§ãƒ†ã‚¹ãƒˆ: äºˆå‚™æ©Ÿã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©æ—§

### å¹´1å›

- USBãƒ‰ãƒ©ã‚¤ãƒ–ã®å¥åº·ãƒã‚§ãƒƒã‚¯
- ãƒ©ã‚ºãƒ‘ã‚¤ã®SDã‚«ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®é€£çµ¡å…ˆ

| é …ç›® | æƒ…å ± |
|------|------|
| ç®¡ç†è€… | ã‚ãªãŸã®é€£çµ¡å…ˆ |
| å¾©æ—§æ‰‹é †æ›¸ | /home/pi/ecm/backend/docs/recovery.md |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å ´æ‰€ | /mnt/usb_backup/ecm/ |

---

**ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ‰**